// -----------------------------------------------------------------
//	CONTRACT: TheMaddnessfromtheSea- The University of Kambridge - The University of Kambridge - Find Kerthulhu
//	Author: Caerfinon 
// -----------------------------------------------------------------

CONTRACT_TYPE
{
//CONTRACT DESCRIPTION
	sortKey = TCOK03
	name = TCOK03-TheMaddnessfromtheSea
	title =  The Maddness from the Sea
	group = The University of Kambridge
	agent = The University of Kambridge
	description = Prof. Legrasse Kerman and his team have examined the evidence we have gathered and have made a startaling diccovery. They believe they have found the location of the city of Ker'Lyeh, Kerthulhu's fabled city. They need our help to reach it as it appears to be at the bottom of the Ocean. The professor want to come on this voyage with us so we need to pick him up from The University of Kambridge and then be on our way.
	genericDescription = Pick up Prof. Legrasse Kerman and explore the underwater site of Ker'Lyeh
	synopsis = Discover the lost city of Ker'Lyeh     
	completedMessage = The Call of Kerthulhu&br;&br;Here ends our tale or does it? You know too much, and the cult still lives.&br; - Beware - 

//Contract Limits
	maxCompletions = 1 
	maxSimultaneous = 1
	autoAccept = false
	declinable = true
	cancellable = true
	minExpiry = 5.0
	maxExpiry = 5.0
	deadline = 0

//Contract Reward Modifiers
	prestige = Exceptional
	targetBody = Kerbin
	
//Contract Rewards
	advanceFunds = (@/rewardFunds * 0.25 )
	rewardFunds = 40000 * Random(1.0, 1.15)
	rewardReputation = 1.0
	rewardScience = 2.0

//Contract Penalties
	failureFunds = @/rewardFunds * Random(1.0, 1.15)
	failureReputation = 3.0
	

// REQUIREMENTS FOR CONTRACT TO APPEAR


	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		contractType = TCOK02-TheTaleofLegrasse
		minCount = 1
	}

// -----------------------------------------------------------------	
//DATA NODES TO PROCESS FOR CONTRACT USE
// -----------------------------------------------------------------

	DATA
	{
		type = List<Kerbal>
		
		kerbals = [ NewKerbal( Male, "Prof. Legrasse Kerman", "Citizen" ) ]
		hidden = true
		
	}




// -----------------------------------------------------------------
//BEHAVIOURS TO DO WHEN CREATING CONTRACT
// -----------------------------------------------------------------
//

	BEHAVIOUR
	{
		name = SpawnKerbal
		type = SpawnKerbal
		
		KERBAL
		{
			kerbal = @/kerbals.ElementAt(0)
			kerbalType = Unowned
			owned = false
			addToRoster = false
			lat = @/SiteWaypointGenerator.ElementAt(0).Latitude()
			lon = @/SiteWaypointGenerator.ElementAt(0).Longitude()
			heading = Random(0,359)
	
		}
	}
	
	BEHAVIOUR
	{
		name = RemoveKerbal
		type = RemoveKerbal
		kerbal = @/kerbals.ElementAt(0)
	}
	
	


	BEHAVIOUR
	{
		name = SiteWaypointGenerator
		type = WaypointGenerator
		
		// Start and End location
		WAYPOINT
		{
			name = @TCOK:HarbourName.ElementAt(@/harbourSelected)
			targetBody = @/targetBody
			icon = ContractPacks/KerbinSideRemasteredTLA/Assets/Icons/port
			altitude = 0
			latitude = @TCOK:HarbourLAT.ElementAt(@/harbourSelected)
			longitude = @TCOK:HarbourLON.ElementAt(@/harbourSelected)
		}
		
	    WAYPOINT
		{
			name = @TCOK:siteFullName.ElementAt(@/siteSelected)
			targetBody = @/targetBody
			icon = ContractPacks/KerbinSideRemasteredTLA/Assets/Icons/dive
			altitude = 0
			latitude = @TCOK:siteLAT.ElementAt(@/siteSelected)
			longitude = @TCOK:siteLON.ElementAt(@/siteSelected)
		}
		
	    WAYPOINT
		{
			name = @TCOK:dive1Name.ElementAt(@/siteSelected)
			targetBody = @/targetBody
			icon = ContractPacks/KerbinSideRemasteredTLA/Assets/Icons/dive
			altitude = @TCOK:dive1ALT.ElementAt(@/siteSelected)
			latitude = @TCOK:dive1LAT.ElementAt(@/siteSelected)
			longitude = @TCOK:dive1LON.ElementAt(@/siteSelected)
			parameter = step0Reached
		}

	    WAYPOINT
		{
			name = @TCOK:dive2Name.ElementAt(@/siteSelected)
			targetBody = @/targetBody
			icon = ContractPacks/KerbinSideRemasteredTLA/Assets/Icons/dive
			altitude = @TCOK:dive2ALT.ElementAt(@/siteSelected)
			latitude = @TCOK:dive2LAT.ElementAt(@/siteSelected)
			longitude = @TCOK:dive2LON.ElementAt(@/siteSelected)
			parameter = step1Reached
		}

	    WAYPOINT
		{
			name = @TCOK:dive3Name.ElementAt(@/siteSelected)
			targetBody = @/targetBody
			icon = ContractPacks/KerbinSideRemasteredTLA/Assets/Icons/dive
			altitude = @TCOK:dive3ALT.ElementAt(@/siteSelected)
			latitude = @TCOK:dive3LAT.ElementAt(@/siteSelected)
			longitude = @TCOK:dive3LON.ElementAt(@/siteSelected)
			parameter = step2Reached
		}
		
	    WAYPOINT
		{
			name = @TCOK:dive4Name.ElementAt(@/siteSelected)
			targetBody = @/targetBody
			icon = ContractPacks/KerbinSideRemasteredTLA/Assets/Icons/dive
			altitude = @TCOK:dive4ALT.ElementAt(@/siteSelected)
			latitude = @TCOK:dive4LAT.ElementAt(@/siteSelected)
			longitude = @TCOK:dive4LON.ElementAt(@/siteSelected)
			parameter = step3Reached
		}

	}

// Mission Dialog boxes
	BEHAVIOUR
	{
		name = DialogBox
		type = DialogBox
		
		DIALOG_BOX
		{
			condition = CONTRACT_ACCEPTED
			position = CENTER
			
			TEXT
			{
				text = <b>KUMA Undersea Site Exploration:</b> &br;&br; Good show!! We're pleased you are helping us with this. Our scientist is standing by for your arrival at the port. Here is some background information:
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Flags/KUMA 
				characterName = Kebin Undersea Marine Agency
			}
			
		    BREAK
			{
			}
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Legends/@TCOK:siteLegend.ElementAt(@/siteSelected)
				characterName = @TCOK:siteFullName.ElementAt(@/siteSelected)
			}
			
		}

		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = LaunchSite
			
			position = CENTER
			
			TEXT
			{
				text = Everything is stored safely aboard, Get underway to the dive site and good hunting.  
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Flags/KUMA 
				characterName = Kebin Undersea Marine Agency
			}
		}
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = step0Reached
			
			position = CENTER
			
			TEXT
			{
				text = Excellent, you've reached the dive site. We don't know what to expect down there so be careful. Dive Safe.   
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Flags/KUMA 
				characterName = Kebin Undersea Marine Agency
			}
		}		
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = step1Reached
			
			position = CENTER
			
			TEXT
			{
				text = Wow! Would you take a look at that? Take lots of pictures so we can study this site more closely.    
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Flags/KUMA 
				characterName = Kebin Undersea Marine Agency
			}
		}

		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = step2Reached
			
			position = CENTER
			
			TEXT
			{
				text = Wow! Would you take a look at that? Take lots of pictures so we can study this site more closely.    
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Flags/KUMA 
				characterName = Kebin Undersea Marine Agency
			}
		}

		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = step3Reached
			
			position = CENTER
			
			TEXT
			{
				text = Wow! Would you take a look at that? Take lots of pictures so we can study this site more closely.    
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Flags/KUMA 
				characterName = Kebin Undersea Marine Agency
			}
		}			
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = step4Reached
			
			position = CENTER
			
			TEXT
			{
				text = That was a great dive. We are looking forward to going through all the data when you get back. Head back to the ship now and return to port.      
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Flags/KUMA 
				characterName = Kebin Undersea Marine Agency
			}
		}
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = ReturnToPort
			
			position = CENTER
			
			TEXT
			{
				text = Welcome back to port and congratulations on a successful dive. Get your vessel and gear stowed away and then come ashore and tell us alll about your adventure. 
				textColor = #BADA55
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Flags/KUMA 
				characterName = Kebin Undersea Marine Agency
			}
			
		}
		
// failed misssion dialog
		DIALOG_BOX
		{
			condition = CONTRACT_FAILED
			position = CENTER
			title = <b>Sometimes Things Go Wrong</b>
			titleColor = #B00B1E
			
			TEXT
			{
				text = KUMA REPORT: A KSP vessel, while conducting an exploratory dive, was lost with all hands. KUMA wishes to express our deepest sympathies to the families and friends of the lost crew. 
				fontSize = 20
				textColor = #B00B1E
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Flags/KUMA 
				characterName = Kebin Undersea Marine Agency
			}
		}
	}


// -----------------------------------------------------------------
//PARAMETERS FOR CONTRACT COMPLETION
// -----------------------------------------------------------------

		
// Pick up the Observer
	
	PARAMETER
	{
		name = MeetLagrasse
		type = VisitWaypoint
		title = Go to the University of Kambridge
		index = 0
		distance = 10
		hideOnCompletion = false
		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true
	}
	
	PARAMETER
	{
		name = PickupLagrasse
		type = HasCrew
		title = Pick up Prof. Legrasse Kerman for the voyage to Ker'Leyh
		kerbal = Prof. Legrasse Kerman
		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true
	}

// -----------------------------------------------------------------	
// follow the dive course
// -----------------------------------------------------------------	
	PARAMETER
	{
		name = DiveSites
		type = Sequence
		title = Discovering Ker'Leyh
		notes = Subsequent locations are hidden until revealed
		completeInSequence = true
		disableOnStateChange = true
		hiddenParameter = step1Reached 
		hiddenParameter = step2Reached
		hiddenParameter = step3Reached
		hiddenParameter = step4Reached
		
		
	// -----------------------------------------------------------------		
	// Travel to the site
	// -----------------------------------------------------------------		

		PARAMETER
		{
			name = step0Reached
			type = VisitWaypoint
			title = Travel to the location of Ker'Leyh
			index = 1
			distance = 200
			showMessages =  true
			hideOnCompletion = true
			completeInSequence = true
			hideChildren = true
		}		

// -----------------------------------------------------------------	
// siteDive1
// -----------------------------------------------------------------


		PARAMETER
		{
			name = step1Reached
			type = All
			title = Descend into the depths and EVA a diver to investigate the site 
			completeInSequence = true
			disableOnStateChange = true

			PARAMETER
			{
				name = VesselIsType
				type = VesselIsType
				title = on an EVA dive
				vesselType = EVA
				hideChildren = true
				completeInSequence = true
				disableOnStateChange = false
				hidden = true
			}
			
			PARAMETER
			{
				name = VisitWaypoint
				type = VisitWaypoint
				title = approach within 3 meter of the dive marker
				index = 2
				distance = 3
				showMessages =  true
				hideOnCompletion = false
				completeInSequence = true
				disableOnStateChange = false
				hideChildren = true
			}
		}
		
	// -----------------------------------------------------------------	
	// siteDive2
	// -----------------------------------------------------------------
		PARAMETER
		{
			name = step2Reached
			type = All
			title = Continue to the second marker
			completeInSequence = true
			disableOnStateChange = true

			PARAMETER
			{
				name = VesselIsType
				type = VesselIsType
				title = on an EVA dive
				vesselType = EVA
				hideChildren = true
				completeInSequence = true
				disableOnStateChange = false
			}
			
			PARAMETER
			{
				name = VisitWaypoint
				type = VisitWaypoint
				title = approach within 3 meter of the dive marker
				index = 3
				distance = 3
				showMessages =  true
				hideOnCompletion = false
				completeInSequence = true
				disableOnStateChange = false
				hideChildren = true
			}
		}

	// -----------------------------------------------------------------	
	// siteDive3
	// -----------------------------------------------------------------
		PARAMETER
		{
			name = step3Reached
			type = All
			title = Continue to the Third marker
			completeInSequence = true
			disableOnStateChange = true

			PARAMETER
			{
				name = VesselIsType
				type = VesselIsType
				title = on an EVA dive
				vesselType = EVA
				hideChildren = true
				completeInSequence = true
				disableOnStateChange = false
				hidden = true
			}
			
			PARAMETER
			{
				name = VisitWaypoint
				type = VisitWaypoint
				title = approach within 3 meter of the dive marker
				index = 4
				distance = 3
				showMessages =  true
				hideOnCompletion = false
				completeInSequence = true
				disableOnStateChange = false
				hideChildren = true
			}
		}

	// -----------------------------------------------------------------	
	// siteDive4
	// -----------------------------------------------------------------
		PARAMETER
		{
			name = step4Reached
			type = VesselParameterGroup
			type = All
			title = Continue to the Fourth marker
			completeInSequence = true
			disableOnStateChange = true

			PARAMETER
			{
				name = VesselIsType
				type = VesselIsType
				title = on an EVA dive
				vesselType = EVA
				hideChildren = true
				completeInSequence = true
				disableOnStateChange = false
			}
			
			PARAMETER
			{
				name = VisitWaypoint
				type = VisitWaypoint
				title = approach within 3 meter of the dive marker
				index = 5
				distance = 3
				showMessages =  true
				hideOnCompletion = false
				completeInSequence = true
				disableOnStateChange = false+
				hideChildren = true
			}
		}
    }	

// -----------------------------------------------------------------	
// Return to KSC
// -----------------------------------------------------------------	

	PARAMETER
	{
		name = Mission Accomplished
		type = VisitWaypoint
		title = Return to port at the KSC
		index = 7
		distance = 100.0
		showMessages = true
		disableOnStateChange = true
		completeInSequence = true
		hideChildren = true
	}

// -----------------------------------------------------------------		
//Recovery Parameter - Recover Kerbals
// -----------------------------------------------------------------	
	PARAMETER
	{
		name = RecoverKerbal
		type = RecoverKerbal
		title = recover Prof. Legrasse Kerman
		kerbal = @/kerbals.ElementAt(0)
		completeInSequence = true		
		hideChildren = true
	}

// -----------------------------------------------------------------
// END OF CONTRACT
// -----------------------------------------------------------------
}